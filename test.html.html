<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scroll Scrub Video</title>

  <!-- GSAP (for easing + scroll tweening) -->
  <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
  <script src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #FAFAFA;
      overflow: hidden; /* prevents scrollbar */
      font-family: system-ui, sans-serif;
    }

    .stage {
      width: 100%;
      height: 100vh; /* exact full screen height */
      position: relative;
      background: #FAFAFA;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain; /* always fit horizontally */
      background: #FAFAFA;
      opacity: 0;
      transition: opacity 0.6s ease-out, transform 0.8s ease-out;
      transform: scale(0.995);
    }

    video.ready {
      opacity: 1;
      transform: scale(1);
    }

    .loader {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      width: 240px;
      height: 4px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .loader i {
      display: block;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #007aff, #1ac6ff);
      transition: width 0.2s linear;
    }

    .hint {
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      font-weight: 600;
      font-size: 14px;
      color: #111;
      opacity: 0.6;
    }
  </style>
</head>

<body>
  <div class="stage">
    <video id="heroVideo" preload="auto" muted playsinline></video>
    <div class="loader"><i id="progress"></i></div>
    <div class="hint">Scroll or swipe to explore</div>
  </div>

  <script>
    const video = document.getElementById("heroVideo");
    const progressBar = document.getElementById("progress");
    const STAGE = document.querySelector(".stage");

    // âœ… Set your hosted video URL (Framer CDN or your server)
    const VIDEO_URL = "https://framerusercontent.com/assets/your-video-id/hero.mp4";

    // Preload video with progress indicator
    async function preloadVideo(url) {
      const response = await fetch(url);
      const reader = response.body.getReader();
      const contentLength = +response.headers.get("Content-Length");
      let received = 0;
      const chunks = [];

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        chunks.push(value);
        received += value.length;
        const percent = (received / contentLength) * 100;
        progressBar.style.width = percent + "%";
      }

      const blob = new Blob(chunks, { type: "video/mp4" });
      return URL.createObjectURL(blob);
    }

    // Scroll scrub logic
    function setupScrollScrub() {
      gsap.registerPlugin(ScrollTrigger);

      // Create fake scroll space (1px scroll range = 1% video)
      const scrollHeight = 5000; // adjust for speed
      document.body.style.height = scrollHeight + "px";

      let targetTime = 0;
      let rafId;

      const loop = () => {
        const progress = window.scrollY / (scrollHeight - window.innerHeight);
        const safeEnd = Math.max(0, (video.duration || 0) - 0.05);
        targetTime = progress * safeEnd;
        const current = video.currentTime;
        video.currentTime += (targetTime - current) * 0.15; // smooth easing
        rafId = requestAnimationFrame(loop);
      };
      loop();
    }

    // Load video and initialize
    (async () => {
      const videoSrc = await preloadVideo(VIDEO_URL);
      video.src = videoSrc;

      video.addEventListener("loadeddata", () => {
        // Fade in nicely
        video.classList.add("ready");
        gsap.delayedCall(0.3, setupScrollScrub);
      });
    })();
  </script>
</body>
</html>
